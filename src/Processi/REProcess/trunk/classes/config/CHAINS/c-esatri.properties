#--------------------------------------------------------------
# File di configurazione in cui sono indicato i valori dei soli
# parametri di contesto della catena jelly da passare alla 
# regola 
#------------------------------------------------------------
# Numero di parametri previsti in input
rengine.jchain.in.nof=2
#------------------------------------------------------------
# Le coppie chiavi/valore hanno come key lo stesso nome 
# indicato nello script jelly xml
#------------------------------------------------------------
rengine.jchain.in.1.key=COMANDISQL_1
rengine.jchain.in.1.value=INSERT INTO  MI_ESATRI_ICI0(CODICE_CONCESSIONE,ANNO_RIF_RISCOSSIONI,DATA_SCADENZA,PROGRESSIVO_INVIO,NUM_SUPPORTI,NUM_ORDINE_SUPP,CODICE_FORNITURA)select  CODICE_CONCESSIONE    ,  TO_NUMBER(ANNO_RIF_RISCOSSIONI)  ,  DATA_SCADENZA         ,  TO_NUMBER(PROGRESSIVO_INVIO)     ,  TO_NUMBER(NUM_SUPPORTI)          ,  TO_NUMBER(NUM_ORDINE_SUPP)       ,  CODICE_FORNITURAfrom TESTATA_ESATRI_1_0wherecaronte_flag_elaborato = 0 ;INSERT INTO  MI_ESATRI_ICI9(CODICE_CONCESSIONE,ANNO_RIF_RISCOSSIONI,DATA_SCADENZA,PROGRESSIVO_INVIO,NUM_REC_TIPO_1,NUM_REC_TIPO_3,NUM_REC_TIPO_4_5,NUM_REC_TIPO_6,CODICE_FORNITURA)selectSUBSTR_TRIM(RIGA_DETTAGLIO, 5,3) CODICE_CONCESSIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 8,4)) ANNO_RIF_RISCOSSIONI,SUBSTR_TRIM(RIGA_DETTAGLIO, 12,8) DATA_SCADENZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 20,2)) PROGRESSIVO_INVIO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 22,10)) NUM_REC_TIPO_1,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 32,10)) NUM_REC_TIPO_3,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 42,10)) NUM_REC_TIPO_4_5,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO, 52,10)) NUM_REC_TIPO_6,CODICE_FORNITURAfrom DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) = 'ICI9';				INSERT INTO  MI_ESATRI_RIV(CODICE_CONCESSIONE,CODICE_ENTE,NUMERO_QUIETANZA,PROGRESSIVO_RECORD,TIPO_RECORD,DATA_RIVERSAMENTO,CODICE_TESORERIA,IMPORTO_VERSATO,IMPORTO_COMMISSIONE,NUMERO_RISCOSSIONI,FLAG_TIPO_RIVERSAMENTO,TIPOLOGIA_RISCOSSIONI_VERSATE,CODICE_FORNITURA,PK_RIVERSAMENTO)selectTO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,1 ,3)) CODICE_CONCESSIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,4,4) CODICE_ENTE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,8,10)) NUMERO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,18,8)) PROGRESSIVO_RECORD,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,26,1)) TIPO_RECORD,SUBSTR_TRIM(RIGA_DETTAGLIO,27,8) DATA_RIVERSAMENTO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,35,3)) CODICE_TESORERIA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,38,13))/100 IMPORTO_VERSATO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,51,10))/100 IMPORTO_COMMISSIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,61,6)) NUMERO_RISCOSSIONI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,67,1)) FLAG_TIPO_RIVERSAMENTO,SUBSTR_TRIM(RIGA_DETTAGLIO,68,1) TIPOLOGIA_RISCOSSIONI_VERSATE,CODICE_FORNITURA,CODICE_FORNITURA||SUBSTR_TRIM(RIGA_DETTAGLIO, 18,8) PK_RIVERSAMENTOfrom DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 26,1) = '1'				and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) <> 'ICI9';								INSERT INTO  MI_ESATRI_RIS_CON(CODICE_CONCESSIONE,CODICE_ENTE,NUMERO_QUIETANZA,PROGRESSIVO_RECORD,TIPO_RECORD,DATA_VERSAMENTO_CONTRIBUENTE,CODICE_FISCALE_CONTRIBUENTE,PERIODO_RIFERIMENTO,NUMERO_RIFERIMENTO_QUIETANZA,IMPORTO_VERSATO,IMPORTO_TERRENI_AGRICOLI,IMPORTO_AREE_FABBRICABILI,IMPORTO_ABITAZIONE_PRINCIPALE,IMPORTO_ALTRI_FABBRICATI,IMPORTO_DETRAZIONE_ABIT_PRINC,FLAG_QUADRATURA,FLAG_REPERIBILITA,TIPO_VERSAMENTO,DATA_REGISTRAZIONE,FLAG_COMPETENZA,COMUNE_IMMOBILI,CAP_COMUNE_IMMOBILI,NUMERO_FABBRICATI,FLAG_ACCONTO_SALDO,FLAG_IDENTIFICAZIONE,PERIODO_RIF_VERSAMENTO,CODICE_FORNITURA,FK_RIVERSAMENTO)select		TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,1 ,3)) CODICE_CONCESSIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,4,4) CODICE_ENTE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,8,10)) NUMERO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,18,8)) PROGRESSIVO_RECORD,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,26,1)) TIPO_RECORD,SUBSTR_TRIM(RIGA_DETTAGLIO,27,8) DATA_VERSAMENTO_CONTRIBUENTE,SUBSTR_TRIM(RIGA_DETTAGLIO,35,16) CODICE_FISCALE_CONTRIBUENTE,SUBSTR_TRIM(RIGA_DETTAGLIO,51,2) PERIODO_RIFERIMENTO,SUBSTR_TRIM(RIGA_DETTAGLIO,53,11) NUMERO_RIFERIMENTO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,64,11))/100 IMPORTO_VERSATO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,75,10))/100 IMPORTO_TERRENI_AGRICOLI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,85,10))/100 IMPORTO_AREE_FABBRICABILI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,95,10))/100 IMPORTO_ABITAZIONE_PRINCIPALE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,105,10))/100 IMPORTO_ALTRI_FABBRICATI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,115,8))/100 IMPORTO_DETRAZIONE_ABIT_PRINC,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,123,1)) FLAG_QUADRATURA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,124,1)) FLAG_REPERIBILITA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,125,1)) TIPO_VERSAMENTO,SUBSTR_TRIM(RIGA_DETTAGLIO,126,8) DATA_REGISTRAZIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,134,1)) FLAG_COMPETENZA,SUBSTR_TRIM(RIGA_DETTAGLIO,135,25) COMUNE_IMMOBILI,SUBSTR_TRIM(RIGA_DETTAGLIO,160,5) CAP_COMUNE_IMMOBILI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,165,4)) NUMERO_FABBRICATI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,169,1)) FLAG_ACCONTO_SALDO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,170,1)) FLAG_IDENTIFICAZIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,171,4)) PERIODO_RIF_VERSAMENTO,CODICE_FORNITURA,CODICE_FORNITURA||SUBSTR_TRIM(RIGA_DETTAGLIO, 18,8) PK_RIVERSAMENTO					from DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 26,1) = '3'				and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) <> 'ICI9';													INSERT INTO  MI_ESATRI_RIS_PF(CODICE_CONCESSIONE,CODICE_ENTE,NUMERO_QUIETANZA,PROGRESSIVO_RECORD,TIPO_RECORD,COGNOME,NOME,COMUNE_DOMICILIO,CODICE_FORNITURA)selectTO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,1 ,3)) CODICE_CONCESSIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,4,4) CODICE_ENTE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,8,10)) NUMERO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,18,8)) PROGRESSIVO_RECORD,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,26,1)) TIPO_RECORD,SUBSTR_TRIM(RIGA_DETTAGLIO,27,24) COGNOME,SUBSTR_TRIM(RIGA_DETTAGLIO,51,20) NOME,SUBSTR_TRIM(RIGA_DETTAGLIO,71,25) COMUNE_DOMICILIO,CODICE_FORNITURAfrom DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 26,1) = '4'					and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) <> 'ICI9';INSERT INTO  MI_ESATRI_RIS_PG(CODICE_CONCESSIONE,CODICE_ENTE,NUMERO_QUIETANZA,PROGRESSIVO_RECORD,TIPO_RECORD,RAGIONE_SOCIALE,COMUNE_DOMICILIO,CODICE_FORNITURA)selectTO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,1 ,3)) CODICE_CONCESSIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,4,4) CODICE_ENTE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,8,10)) NUMERO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,18,8)) PROGRESSIVO_RECORD,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,26,1)) TIPO_RECORD,SUBSTR_TRIM(RIGA_DETTAGLIO,27,60) RAGIONE_SOCIALE,SUBSTR_TRIM(RIGA_DETTAGLIO,87,25) COMUNE_DOMICILIO,CODICE_FORNITURAfrom DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 26,1) = '5'					and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) <> 'ICI9'  ;			 			 		INSERT INTO  MI_ESATRI_RIS_VIO(CODICE_CONCESSIONE,CODICE_ENTE,NUMERO_QUIETANZA,PROGRESSIVO_RECORD,TIPO_RECORD,DATA_VERSAMENTO_CONTRIBUENTE,CODICE_FISCALE_CONTRIBUENTE,NUMERO_RIFERIMENTO_QUIETANZA,IMPORTO_VERSATO,IMPORTO_IMPOSTA,IMPORTO_SANZIONI_1,IMPORTO_SANZIONI_2,IMPORTO_INTERESSI,FLAG_QUADRATURA,FLAG_REPERIBILITA,TIPO_VERSAMENTO,DATA_REGISTRAZIONE,FLAG_COMPETENZA,COMUNE_IMMOBILI,CAP_COMUNE_IMMOBILI,FLAG_IDENTIFICAZIONE,ANNO_IMPOSTA_VIOLAZIONE,NUMERO_LIQUIDAZIONE,DATA_LIQUIDAZIONE,CODICE_FORNITURA,FK_RIVERSAMENTO)selectTO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,1 ,3)) CODICE_CONCESSIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,4,4) CODICE_ENTE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,8,10)) NUMERO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,18,8)) PROGRESSIVO_RECORD,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,26,1)) TIPO_RECORD,SUBSTR_TRIM(RIGA_DETTAGLIO,27,8) DATA_VERSAMENTO_CONTRIBUENTE,SUBSTR_TRIM(RIGA_DETTAGLIO,35,16) CODICE_FISCALE_CONTRIBUENTE,SUBSTR_TRIM(RIGA_DETTAGLIO,53,11) NUMERO_RIFERIMENTO_QUIETANZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,64,11))/100 IMPORTO_VERSATO,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,75,10))/100 IMPORTO_IMPOSTA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,85,10))/100 IMPORTO_SANZIONI_1,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,95,10))/100 IMPORTO_SANZIONI_2,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,105,10))/100 IMPORTO_INTERESSI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,123,1)) FLAG_QUADRATURA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,124,1)) FLAG_REPERIBILITA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,125,1)) TIPO_VERSAMENTO,SUBSTR_TRIM(RIGA_DETTAGLIO,126,8) DATA_REGISTRAZIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,134,1)) FLAG_COMPETENZA,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,135,25)) COMUNE_IMMOBILI,SUBSTR_TRIM(RIGA_DETTAGLIO,160,5) CAP_COMUNE_IMMOBILI,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,170,1)) FLAG_IDENTIFICAZIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,171,4)) ANNO_IMPOSTA_VIOLAZIONE,TO_NUMBER_ALL(SUBSTR_TRIM(RIGA_DETTAGLIO,175,6)) NUMERO_LIQUIDAZIONE,SUBSTR_TRIM(RIGA_DETTAGLIO,181,8) DATA_LIQUIDAZIONE,CODICE_FORNITURA,CODICE_FORNITURA||SUBSTR_TRIM(RIGA_DETTAGLIO, 18,8) FK_RIVERSAMENTOfrom DETTAGLIO_ESATRI_1_0wherecaronte_flag_elaborato = 0and SUBSTR_TRIM(RIGA_DETTAGLIO, 26,1) = '6'					and SUBSTR_TRIM(RIGA_DETTAGLIO, 1,4) <> 'ICI9' ;					             UPDATE DETTAGLIO_ESATRI_1_0 SET caronte_flag_elaborato = 1 where caronte_flag_elaborato = 0;UPDATE TESTATA_ESATRI_1_0 SET caronte_flag_elaborato = 1 where caronte_flag_elaborato = 0;
rengine.jchain.in.2.key=TABELLE_SEMAFORO_1
rengine.jchain.in.2.value=DETTAGLIO_ESATRI_1_0,TESTATA_ESATRI_1_0
