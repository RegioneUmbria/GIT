#------------------------------------------------------------
# File di config della regola
#------------------------------------------------------------
rengine.rule.class=it.webred.rulengine.brick.core.EseguiVerificaIntegrazioneDatiDocfa
rengine.rule.cc=DOCFA_V2_0
rengine.rule.number.params.in=1
rengine.rule.number.params.out=0
#------------------------------------------------------------
# parametri di input
#------------------------------------------------------------
rengine.rule.param.in.1.type=java.lang.String
rengine.rule.param.in.1.descr=ElencoDateFornitura
#------------------------------------------------------------
# parametri di output
#------------------------------------------------------------
#
#------------------------------------------------------------
# Definizioni costanti o proprietà aggiuntive della regola
#------------------------------------------------------------	
rengine.rule.sql.docfa.value=select distinct protocollo_reg, TO_CHAR(FORNITURA,'dd/mm/yyyy')FORNITURA from docfa_dati_generali
rengine.rule.sql.docfadic.value=select dic_cognome,dic_nome, dic_res_indir,dic_res_numciv,dic_res_cap,dic_res_com,dic_res_prov from docfa_dichiaranti where protocollo_reg = ? and FORNITURA = to_date(?,'dd/mm/yyyy')
rengine.rule.sql.uiudocfa.value=select distinct uiu.FOGLIO,uiu.NUMERO,uiu.SUBALTERNO,uiu.TIPO_OPERAZIONE,uiu.INDIR_TOPONIMO,uiu.INDIR_NCIV_UNO ,uiu.PROP_CATEGORIA,uiu.PROP_CLASSE,uiu.PROP_RENDITA_EURO_CATA,uiu.PROP_SUPERFICIE_CATA,uiu.PROP_ZONA_CENSUARIA from docfa_uiu uiu where protocollo_reg = ? and uiu.FORNITURA = to_date(?,'dd/mm/yyyy') order by uiu.FOGLIO,uiu.NUMERO,uiu.SUBALTERNO
rengine.rule.sql.uiucensdocfa.value=select zona,categoria,classe,superficie,rendita_euro from DOCFA_DATI_CENSUARI where PROTOCOLLO_REGISTRAZIONE = ? and FORNITURA = to_date(?,'dd/mm/yyyy') and foglio = ? and numero = ? and subalterno = ?
rengine.rule.sql.uiucatastos.value=SELECT distinct siticivi_uiu.PRINCIPALE,DECODE (sitiuiu.cod_nazionale,NULL, '-',sitiuiu.cod_nazionale) AS fk_comune,sitiuiu.particella AS particella,DECODE (sitiuiu.foglio, NULL, '-', sitiuiu.foglio) AS foglio,DECODE (sitiuiu.sub, NULL, '-', sitiuiu.sub) AS subalterno,DECODE (sitiuiu.unimm, NULL, '-', sitiuiu.unimm) AS unimm,DECODE (sitiuiu.consistenza,NULL, '-',sitiuiu.consistenza) AS vani,DECODE (sitiuiu.sup_cat, NULL, '-', sitiuiu.sup_cat) AS superficie,DECODE (sitiuiu.zona, NULL, '-', sitiuiu.zona) AS zona,DECODE (sitiuiu.microzona,NULL, '-',sitiuiu.microzona) AS microzona,DECODE (sitiuiu.rendita, NULL, '-', sitiuiu.rendita) AS rendita,DECODE (sitiuiu.classe, NULL, '-', sitiuiu.classe) AS classe,DECODE (sitiuiu.partita, NULL, '-', sitiuiu.partita) AS partita,DECODE (sitiuiu.piano, NULL, '-', sitiuiu.piano) AS piano,DECODE (sitiuiu.categoria,NULL, '-',sitiuiu.categoria) AS categoria, sitideco.description AS descategoria,siticivi.civico,sitidstr.prefisso || ' ' || sitidstr.nome AS indirizzo,siticivi.pkid_civi AS pk_civico, sitidstr.pkid_stra AS pk_indirizzo,TO_CHAR (sitiuiu.data_inizio_val, 'dd/mm/yyyy') AS data_inizio_val,TO_CHAR (sitiuiu.data_fine_val, 'dd/mm/yyyy') AS data_fine_val FROM sitiuiu, sitideco, siticivi_uiu, siticivi, sitidstr WHERE sitiuiu.cod_nazionale = '$COD_ENTE' AND sitiuiu.foglio = ? AND sitiuiu.particella = ? AND DECODE (sitiuiu.sub,' ', '-',NVL (sitiuiu.sub, '*'), '-',sitiuiu.sub) = DECODE (NVL (' ', '*'), '*', '-', ' ', '-', ' ') AND sitiuiu.unimm = ? AND sitideco.tablename = 'SITIUIU' AND sitideco.fieldname = 'CATEGORIA' AND sitideco.code = sitiuiu.categoria AND (sitiuiu.data_inizio_val <= TO_DATE (?, 'dd/mm/yyyy')AND sitiuiu.data_fine_val >= TO_DATE (?, 'dd/mm/yyyy')  ) AND siticivi_uiu.pkid_uiu(+) = sitiuiu.pkid_uiu AND siticivi_uiu.pkid_civi = siticivi.pkid_civi(+) AND sitidstr.pkid_stra(+) = siticivi.pkid_stra AND siticivi_uiu.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd') AND siticivi.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd') AND sitidstr.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd')	 ORDER BY data_fine_val,indirizzo, civico
rengine.rule.sql.uiucatastoc.value=SELECT distinct siticivi_uiu.PRINCIPALE,DECODE (sitiuiu.cod_nazionale,NULL, '-',sitiuiu.cod_nazionale) AS fk_comune,sitiuiu.particella AS particella,DECODE (sitiuiu.foglio, NULL, '-', sitiuiu.foglio) AS foglio,DECODE (sitiuiu.sub, NULL, '-', sitiuiu.sub) AS subalterno,DECODE (sitiuiu.unimm, NULL, '-', sitiuiu.unimm) AS unimm,DECODE (sitiuiu.consistenza,NULL, '-',sitiuiu.consistenza) AS vani,DECODE (sitiuiu.sup_cat, NULL, '-', sitiuiu.sup_cat) AS superficie,DECODE (sitiuiu.zona, NULL, '-', sitiuiu.zona) AS zona,DECODE (sitiuiu.microzona,NULL, '-',sitiuiu.microzona) AS microzona,DECODE (sitiuiu.rendita, NULL, '-', sitiuiu.rendita) AS rendita,DECODE (sitiuiu.classe, NULL, '-', sitiuiu.classe) AS classe,DECODE (sitiuiu.partita, NULL, '-', sitiuiu.partita) AS partita,DECODE (sitiuiu.piano, NULL, '-', sitiuiu.piano) AS piano,DECODE (sitiuiu.categoria,NULL, '-',sitiuiu.categoria) AS categoria, sitideco.description AS descategoria,siticivi.civico,sitidstr.prefisso || ' ' || sitidstr.nome AS indirizzo,siticivi.pkid_civi AS pk_civico, sitidstr.pkid_stra AS pk_indirizzo,TO_CHAR (sitiuiu.data_inizio_val, 'dd/mm/yyyy') AS data_inizio_val,TO_CHAR (sitiuiu.data_fine_val, 'dd/mm/yyyy') AS data_fine_val FROM sitiuiu, sitideco, siticivi_uiu, siticivi, sitidstr WHERE sitiuiu.cod_nazionale = '$COD_ENTE' AND sitiuiu.foglio = ? AND sitiuiu.particella = ? AND DECODE (sitiuiu.sub,' ', '-',NVL (sitiuiu.sub, '*'), '-',sitiuiu.sub) = DECODE (NVL (' ', '*'), '*', '-', ' ', '-', ' ') AND sitiuiu.unimm = ? AND sitideco.tablename = 'SITIUIU' AND sitideco.fieldname = 'CATEGORIA' AND sitideco.code = sitiuiu.categoria AND sitiuiu.data_inizio_val >= TO_DATE (?, 'dd/mm/yyyy')AND siticivi_uiu.pkid_uiu(+) = sitiuiu.pkid_uiu AND siticivi_uiu.pkid_civi = siticivi.pkid_civi(+) AND sitidstr.pkid_stra(+) = siticivi.pkid_stra AND siticivi_uiu.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd') AND siticivi.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd') AND sitidstr.data_fine_val(+) = TO_DATE ('99991231', 'yyyymmdd')	 ORDER BY data_fine_val,indirizzo, civico
rengine.rule.sql.uiudgraf.value=SELECT distinct foglio,mappale,sub,id_imm FROM load_cat_uiu_id WHERE id_imm = (SELECT distinct id_imm FROM load_cat_uiu_id WHERE foglio= ? and mappale= ? and sub= ? and rownum = 1)
rengine.rule.sql.uiutitos.value=SELECT distinct cons_sogg_tab.flag_pers_fisica,DECODE (cons_sogg_tab.ragi_soci,NULL, '-',cons_sogg_tab.ragi_soci) AS denominazione,DECODE (cons_sogg_tab.nome,NULL, '-',cons_sogg_tab.nome) AS nome,DECODE(siticomu.cod_nazionale ,NULL, '-',siticomu.cod_nazionale)AS fk_comune,DECODE (siticomu.nome, NULL, '-', siticomu.nome) AS sede,DECODE (cons_sogg_tab.codi_piva,NULL, '-',cons_sogg_tab.codi_piva) AS partita_iva,DECODE (cons_sogg_tab.CODI_FISC ,NULL, '-',cons_sogg_tab.CODI_FISC) AS codi_fisc,DECODE (cons_sogg_tab.pk_cuaa, NULL, '-', cons_sogg_tab.pk_cuaa) AS pk_cuaa,NVL (TO_CHAR (cons_csui_tab.data_inizio, 'dd/mm/yyyy'),'-') AS data_inizio,NVL (TO_CHAR (cons_csui_tab.data_fine, 'dd/mm/yyyy'),'-') AS data_fine,DECODE (cons_csui_tab.perc_poss,NULL, '-',cons_csui_tab.perc_poss) AS QUOTA,DECODE (cons_sogg_tab.sesso,NULL, '-',cons_sogg_tab.sesso) AS sesso,NVL (TO_CHAR (cons_sogg_tab.data_nasc, 'dd/mm/yyyy'),'-') AS data_nasc,DECODE (cons_sogg_tab.comu_nasc,NULL, '-',cons_sogg_tab.comu_nasc) AS comune_nascita FROM cons_csui_tab, cons_sogg_tab, siticomu WHERE cons_csui_tab.cod_nazionale = '$COD_ENTE' AND cons_csui_tab.foglio = ? AND cons_csui_tab.particella = ? AND DECODE (cons_csui_tab.sub,' ', '-',NVL (cons_csui_tab.sub, '*'), '-',cons_csui_tab.sub) = DECODE (NVL (' ', '*'), '*', '-', ' ', '-', ' ') AND cons_csui_tab.unimm = ? AND ( cons_csui_tab.data_inizio <= TO_DATE (?, 'dd/mm/yyyy') AND cons_csui_tab.data_fine >= TO_DATE (?, 'dd/mm/yyyy')) AND    cons_sogg_tab.data_fine = to_date('31/12/9999', 'dd/mm/yyyy') AND cons_csui_tab.pk_cuaa = cons_sogg_tab.pk_cuaa AND SUBSTR (cons_sogg_tab.comu_nasc, 1, 3) = siticomu.istatp(+) AND SUBSTR (cons_sogg_tab.comu_nasc, 4, 3) = siticomu.istatc(+)
rengine.rule.sql.uiutitoc.value=SELECT distinct cons_sogg_tab.flag_pers_fisica,DECODE (cons_sogg_tab.ragi_soci,NULL, '-',cons_sogg_tab.ragi_soci) AS denominazione,DECODE (cons_sogg_tab.nome,NULL, '-',cons_sogg_tab.nome) AS nome,DECODE(siticomu.cod_nazionale ,NULL, '-',siticomu.cod_nazionale)AS fk_comune,DECODE (siticomu.nome, NULL, '-', siticomu.nome) AS sede,DECODE (cons_sogg_tab.codi_piva,NULL, '-',cons_sogg_tab.codi_piva) AS partita_iva,DECODE (cons_sogg_tab.CODI_FISC ,NULL, '-',cons_sogg_tab.CODI_FISC) AS codi_fisc,DECODE (cons_sogg_tab.pk_cuaa, NULL, '-', cons_sogg_tab.pk_cuaa) AS pk_cuaa,NVL (TO_CHAR (cons_csui_tab.data_inizio, 'dd/mm/yyyy'),'-') AS data_inizio,NVL (TO_CHAR (cons_csui_tab.data_fine, 'dd/mm/yyyy'),'-') AS data_fine,DECODE (cons_csui_tab.perc_poss,NULL, '-',cons_csui_tab.perc_poss) AS QUOTA,DECODE (cons_sogg_tab.sesso,NULL, '-',cons_sogg_tab.sesso) AS sesso,NVL (TO_CHAR (cons_sogg_tab.data_nasc, 'dd/mm/yyyy'),'-') AS data_nasc,DECODE (cons_sogg_tab.comu_nasc,NULL, '-',cons_sogg_tab.comu_nasc) AS comune_nascita FROM cons_csui_tab, cons_sogg_tab, siticomu WHERE cons_csui_tab.cod_nazionale = '$COD_ENTE' AND cons_csui_tab.foglio = ? AND cons_csui_tab.particella = ? AND DECODE (cons_csui_tab.sub,' ', '-',NVL (cons_csui_tab.sub, '*'), '-',cons_csui_tab.sub) = DECODE (NVL (' ', '*'), '*', '-', ' ', '-', ' ') AND cons_csui_tab.unimm = ? AND cons_csui_tab.data_inizio >= TO_DATE (?, 'dd/mm/yyyy') AND    cons_sogg_tab.data_fine = to_date('31/12/9999', 'dd/mm/yyyy') AND cons_csui_tab.pk_cuaa = cons_sogg_tab.pk_cuaa AND SUBSTR (cons_sogg_tab.comu_nasc, 1, 3) = siticomu.istatp(+) AND SUBSTR (cons_sogg_tab.comu_nasc, 4, 3) = siticomu.istatc(+)
rengine.rule.sql.uiutitoresana.value=SELECT DISTINCT p.id_orig matricola, p.codfisc codice_fisc, p.cognome, p.nome,p.sesso,cxml.ID_ORIG_VIA cod_via,cxml.viasedime || ' ' || cxml.DESCRIZIONE  descr_via, cxml.civ_liv1 AS numero_civ, cxml.civ_liv2 esp_civ, TO_CHAR (pc.dt_inizio_dato, 'DD/MM/YYYY') data_inizio_res,TO_CHAR (pc.dt_fine_dato, 'DD/MM/YYYY') data_fine_res FROM sit_d_persona_civico pc,sit_d_persona p,sit_d_pers_fam f,SIT_D_CIVICO_VIA_V cxml WHERE pc.id_ext_d_civico = cxml.id_ext AND p.id_ext = pc.id_ext_d_persona(+) AND p.id_ext = f.id_ext_d_persona(+) AND p.codfisc = ?
rengine.rule.sql.uiutitorestributi.value=select cognome,nome,sesso,data_nascita,descr_comune_nascita,descr_indirizzo,comune_residenza from tri_contribuenti where codice_fiscale = ?
rengine.rule.sql.uiutitogtributi.value=select descr_indirizzo,comune_residenza from tri_contribuenti where partita_iva = ? order by provenienza desc
rengine.rule.sql.uiurltitog.value=SELECT DENOMINAZIONE,CAP_DOMICILIO_FISC,COD_DOMICILIO_FISC,IND_CIV_DOMICILIO_FISC,COMUNE_DOMILICIO_FISC,PROVIN_DOMICILIO_FISC,COD_FISC_RAP_LEG_PFIS,COGNOME_RAP_LEG_PFIS,NOME_RAP_LEG_PFIS,IND_CIV_RAP_LEG_PFIS,CAP_RAP_LEG_PFIS,COMUNE_RES_RAP_LEG_PFIS,PROVIN_RES_RAP_LEG FROM MI_SIATEL_P_GIU WHERE COD_FISC_INDIVIDUATO = ?
rengine.rule.sql.insertimportlog.value=INSERT INTO DOCFA_DATA_LOG (IID, ID_FORNITURA, ID_PROTOCOLLO,TABELLA_RECORD,COLONNA_RECORD,CODICE_REGOLA,UIU_FOGLIO,UIU_NUMERO,UIU_SUBALTERNO, PROVENINZA) VALUES (SEQ_DOCFA_IMPORT_LOG.NEXTVAL,?,?,?,?,?,?,?,?,'IMP')
rengine.rule.sql.insertimportlog.param.value=INSERT INTO DOCFA_DATA_LOG   (IID, ID_FORNITURA, ID_PROTOCOLLO,TABELLA_RECORD,COLONNA_RECORD,CODICE_REGOLA,UIU_FOGLIO,UIU_NUMERO,UIU_SUBALTERNO, PROVENINZA) VALUES (SEQ_DOCFA_IMPORT_LOG.NEXTVAL,'$DOCFA_GETDATAFORNITURA','$DOCFA_GETPROTOCOLLOREG',?,?,?,'$UIU_GETFOGLIO','$UIU_GETPARTICELLA','$UIU_GETSUBALTERNO','INT')
rengine.rule.sql.seqcomunicazione.value=SELECT SEQ_DOCFA_COMUN.NEXTVAL AS PROG_COM FROM DUAL
rengine.rule.sql.seqcomogg.value=SELECT SEQ_DOCFA_COMUN_OGG.NEXTVAL AS PROG_COM_OGG FROM DUAL
rengine.rule.sql.insertcomm.value=INSERT INTO DOCFA_COMUNICAZIONE (IID_COMUNICAZIONE, IID_PROTOCOLLO_REG, IID_FORNITURA, CODFISCALE_PIVA, PREFISSO, TELEFONO, DENOMINAZIONE, NOME, DATA_NASCITA, COMUNE_NASCITA, PROVINCIA_NASCITA, SESSO, INDIRIZZO, CAP, COMUNE, PROVINCIA, INDIRIZZO_DOMICILIO, CAP_DOMICILIO, COMUNE_DOMICILIO, PROVINCIA_DOMICILIO, CODICE_FISCALERL, PREFISSORL, TELEFONORL, COGNOMERL, NOMERL, DATA_NASCITARL, COMUNE_NASCITARL, PROVINCIA_NASCITARL, SESSORL, INDIRIZZORL, CAPRL, COMUNERL, PROVINCIARL, INDIRIZZO_DOMICILIORL, CAP_DOMICILIORL, COMUNE_DOMICILIORL, PROVINCIA_DOMICILIORL, FLAG_RAPPRESENTANTE_LEGALE, FLAG_CURATORE_FALLIMENTARE, FLAG_TUTORE, FLAG_EREDE, ALTRA_NATURA, FLAG_PERSONA, DATA_COMUNICAZIONE, STATO, PAGINE, FLAG_ELABORATO) VALUES(?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?)
rengine.rule.sql.insertoggcomm.value=INSERT INTO DOCFA_COMUN_OGGETTO (IID, IID_COMUNICAZIONE, IID_PROTOCOLLO_REG, IID_FORNITURA, CODICE_VARIAZIONE, DESC_VARIAZIONE, DECORRENZA, FLAG_FABBRICATO, FLAG_AREA_FABBRICABILE, FLAG_FABBRICATO_D, FLAG_TERRENO_AGRICOLO, INDIRIZZO, SEZIONE, FOGLIO, PARTICELLA, SUBALTERNO, NUMERO_PROTOCOLLO, ANNO, CATEGORIA, CLASSE, FLAG_RENDITA_PRESUNTA, FLAG_RENDITA_DEFINITIVA, FLAG_VALORE_VENALE, FLAG_COSTI_CONTABILI, FLAG_REDDITO_DOMENICALE, REDDITO_EURO, SEZIONE_VAR, FOGLIO_VAR, PARTICELLA_VAR, SUBALTERNO_VAR, NUMERO_PROTOCOLLO_VAR, ANNO_VAR, CATEGORIA_VAR, CLASSE_VAR, PERCENTUALE_POSSESSO, FLAG_POSSESSO_PROPRIETA, FLAG_POSSESSO_USUFRUTTO, FLAG_POSSESSO_USO, FLAG_POSSESSO_DIRITTO_ABIT, FLAG_POSSESSO_SUPERFICIE, FLAG_POSSESSO_LEASING, ALTRO_POSSESSO, FLAG_ABIT_PRINCIPALE, FLAG_ABIT_PRINCIPALE_NM, CONTITOLARI_ABIT_PRINCIPALE, FLAG_INAGIBILE, FLAG_AGRICOLTURA_DIRETTA, FLAG_IMMOBILE_ESCLUSO, FLAG_RIDUZIONE_LOCAZIONE, FLAG_STORICO, FLAG_DETRAZIONE_DELIB, FLAG_DETRAZIONE_DELIB_NM, MEMBRI_NUCLEO_FAMILIARE, FLAG_PENSIONATO, FLAG_CONIUGE_PENSIONATO, FLAG_INVALIDO, FLAG_DISOCCUPATO, FLAG_MOBILITA, FLAG_INTERINALE, FLAG_COCOCO, GRAFFATO) VALUES(?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?,?,?,?,?,?,?,?,?,? ,?)     



