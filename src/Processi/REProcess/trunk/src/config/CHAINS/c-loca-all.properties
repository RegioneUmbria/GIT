#--------------------------------------------------------------
# File di configurazione in cui sono indicato i valori dei soli
# parametri di contesto della catena jelly da passare alla 
# regola 
#------------------------------------------------------------
# Numero di parametri previsti in input
rengine.jchain.in.nof=8
#------------------------------------------------------------
# Le coppie chiavi/valore hanno come key lo stesso nome 
# indicato nello script jelly xml
#------------------------------------------------------------
rengine.jchain.in.1.key=COMANDISQL_1
rengine.jchain.in.1.value=INSERT INTO  LOCAZIONI_A (UFFICIO,ANNO,SERIE,NUMERO,COD_CAT_COMUNE,INDIRIZZO,TIPO_RECORD,FORNITURA ) select  SUBSTR(RIGA_LOCAZIONI, 2, 3) UFFICIO, TO_NUMBER_ALL(SUBSTR(RIGA_LOCAZIONI, 5, 4)) ANNO, SUBSTR(RIGA_LOCAZIONI, 9, 2) SERIE, TO_NUMBER_ALL(SUBSTR(RIGA_LOCAZIONI, 11, 6)) NUMERO, SUBSTR(RIGA_LOCAZIONI, 17, 4) COD_CAT_COMUNE, SUBSTR(RIGA_LOCAZIONI, 21, 40) INDIRIZZO, SUBSTR(RIGA_LOCAZIONI, 1, 1) TIPO_RECORD, TO_NUMBER(TO_CHAR(RE_DATA_INIZIO_VAL, 'YYMMDDHH24MISS')) FORNITURA      from re_locazioni_1_0  where RE_flag_elaborato = 0  and SUBSTR(RIGA_LOCAZIONI, 1, 1) = 'A'; INSERT INTO  LOCAZIONI_B (UFFICIO,ANNO,SERIE,NUMERO,PROG_SOGGETTO,TIPO_SOGGETTO,CODICEFISCALE,SESSO,CITTA_NASCITA,PROV_NASCITA,DATA_NASCITA,CITTA_RESIDENZA,PROV_RESIDENZA,INDIRIZZO_RESIDENZA,CIVICO_RESIDENZA,TIPO_RECORD,FORNITURA) select  SUBSTR(RIGA_LOCAZIONI,2, 3) UFFICIO,     TO_NUMBER_ALL(SUBSTR(RIGA_LOCAZIONI,5, 4)) ANNO, SUBSTR(RIGA_LOCAZIONI,9, 2) SERIE, TO_NUMBER_ALL(SUBSTR(RIGA_LOCAZIONI,11, 6)) NUMERO, TO_NUMBER_ALL(SUBSTR(RIGA_LOCAZIONI,17, 3)) PROG_SOGGETTO, SUBSTR(RIGA_LOCAZIONI,20, 1) TIPO_SOGGETTO, SUBSTR(RIGA_LOCAZIONI,21, 16) CODICEFISCALE, SUBSTR(RIGA_LOCAZIONI,37, 1) SESSO, SUBSTR(RIGA_LOCAZIONI,38, 30) CITTA_NASCITA, SUBSTR(RIGA_LOCAZIONI,68, 2) PROV_NASCITA, SUBSTR(RIGA_LOCAZIONI,70, 10) DATA_NASCITA, SUBSTR(RIGA_LOCAZIONI,80, 30) CITTA_RESIDENZA, SUBSTR(RIGA_LOCAZIONI,110, 2) PROV_RESIDENZA, SUBSTR(RIGA_LOCAZIONI,112, 35) INDIRIZZO_RESIDENZA, SUBSTR(RIGA_LOCAZIONI,147, 6) CIVICO_RESIDENZA, SUBSTR(RIGA_LOCAZIONI,1, 1) TIPO_RECORD, TO_NUMBER(TO_CHAR(RE_DATA_INIZIO_VAL, 'YYMMDDHH24MISS')) FORNITURA     from re_locazioni_1_0  where RE_flag_elaborato = 0  and SUBSTR(RIGA_LOCAZIONI, 1, 1) = 'B'; UPDATE re_locazioni_1_0 SET RE_flag_elaborato = 1 where RE_flag_elaborato = 0;
rengine.jchain.in.2.key=TABELLE_SEMAFORO_1
rengine.jchain.in.2.value=RE_LOCAZIONI_1_0
#
rengine.jchain.in.3.key=COMANDISQL_2
rengine.jchain.in.3.value=INSERT INTO LOCAZIONI_A (UFFICIO,ANNO,SERIE,NUMERO,SOTTONUMERO,PROG_NEGOZIO,DATA_REGISTRAZIONE, DATA_STIPULA, OGGETTO_LOCAZIONE, CODICE_NEGOZIO,IMPORTO_CANONE, VALUTA, TIPO_CANONE,DATA_INIZIO,DATA_FINE, COD_CAT_COMUNE,INDIRIZZO,TIPO_RECORD,FORNITURA )select util.SUBSTR_TRIM(RIGA_LOCAZIONI, 2, 3) UFFICIO, util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 5, 4)) ANNO, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 9, 2) SERIE,util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 11, 6)) NUMERO,util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI,17,3)) SOTTONUMERO,util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI,20,3)) PROG_NEGOZIO,util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 23, 10),'yyyy-mm-dd') data_registrazione,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 33, 10),'yyyy-mm-dd') data_stipula,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 43, 2) codice_oggetto,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 45, 4) codice_negozio,util.SUBSTR_TRIM(RIGA_LOCAZIONI, 49, 15) importo_canone,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 64, 1) valuta_canone,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 65, 1) tipo_canone,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 66, 10),'yyyy-mm-dd') data_inizio_locazione,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 76, 10),'yyyy-mm-dd') data_fine_locazione,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 86, 4) COD_CAT_COMUNE, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 90, 40) INDIRIZZO,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) TIPO_RECORD,  TO_NUMBER(TO_CHAR(RE_DATA_INIZIO_VAL, 'YYMMDDHH24MISS')) FORNITURA  from re_locazioni_1_1 where RE_flag_elaborato = 0  and util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) = 'A';    INSERT INTO LOCAZIONI_B (UFFICIO,ANNO,SERIE,NUMERO,SOTTONUMERO,PROG_NEGOZIO,PROG_SOGGETTO,TIPO_SOGGETTO,CODICEFISCALE,SESSO,CITTA_NASCITA,PROV_NASCITA,DATA_NASCITA,CITTA_RESIDENZA,PROV_RESIDENZA,INDIRIZZO_RESIDENZA,CIVICO_RESIDENZA,DATA_SUBENTRO, DATA_CESSIONE, TIPO_RECORD,FORNITURA)  SELECT UTIL.substr_trim (riga_locazioni, 2, 3) ufficio,UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 5, 4)) anno,UTIL.substr_trim (riga_locazioni, 9, 2) serie,UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 11, 6)) numero,util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI,17,3)) SOTTONUMERO,util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI,20,3)) PROG_NEGOZIO, UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 23, 3)) prog_soggetto,UTIL.substr_trim (riga_locazioni, 26, 1) tipo_soggetto,UTIL.substr_trim (riga_locazioni, 27, 16) codicefiscale,UTIL.substr_trim (riga_locazioni, 43, 1) sesso,UTIL.substr_trim (riga_locazioni, 44, 30) citta_nascita,        UTIL.substr_trim (riga_locazioni, 74, 2) prov_nascita,        UTIL.substr_trim (riga_locazioni, 76, 10) data_nascita,        UTIL.substr_trim (riga_locazioni, 86, 30) citta_residenza,        UTIL.substr_trim (riga_locazioni, 116, 2) prov_residenza,        UTIL.substr_trim (riga_locazioni, 118, 35) indirizzo_residenza,        UTIL.substr_trim (riga_locazioni, 153, 6) civico_residenza,        util.fchar_to_date(UTIL.substr_trim (riga_locazioni, 159, 10),'yyyy-mm-dd') data_subentro,        util.fchar_to_date( UTIL.substr_trim (riga_locazioni, 169, 10),'yyyy-mm-dd') data_cessione,        UTIL.substr_trim (riga_locazioni, 1, 1) tipo_record,        TO_NUMBER (TO_CHAR (RE_data_inizio_val, 'YYMMDDHH24MISS')                  ) fornitura   FROM re_locazioni_1_1  WHERE RE_flag_elaborato = 0 AND UTIL.substr_trim (riga_locazioni, 1, 1) = 'B'; INSERT INTO locazioni_i (tipo_record,fornitura,ufficio, anno, serie, numero, SOTTONUMERO, PROG_NEGOZIO, PROG_IMMOBILE, ACCATASTAMENTO, TIPO_CATASTO, FLG_INTERO_PORZ, CODICE_CAT, SEZ_URBANA, FOGLIO, PARTICELLA, SUBALTERNO, INDIRIZZO) SELECT util.substr_trim (riga_locazioni, 1, 1) tipo_record, TO_NUMBER (TO_CHAR (re_data_inizio_val, 'YYMMDDHH24MISS')) fornitura, util.substr_trim (riga_locazioni, 2, 3) ufficio, util.to_number_all (util.substr_trim (riga_locazioni, 5, 4)) anno, util.substr_trim (riga_locazioni, 9, 2) serie, util.to_number_all (util.substr_trim (riga_locazioni, 11, 6)) numero, util.to_number_all (util.substr_trim (riga_locazioni, 17, 3)) sottonumero,util.to_number_all (util.substr_trim (riga_locazioni, 20, 3)) prog_negozio,util.to_number_all (util.substr_trim (riga_locazioni, 23, 3)) prog_immobile,util.substr_trim (riga_locazioni, 26, 1) accatastamento,util.substr_trim (riga_locazioni, 27, 1) tipo_catasto, util.substr_trim (riga_locazioni, 28, 1) flg_intero_porz,util.substr_trim (riga_locazioni, 29, 4) codice_cat, util.substr_trim (riga_locazioni, 33, 3) sez_urbana, util.substr_trim (riga_locazioni, 36, 4) foglio, util.substr_trim (riga_locazioni, 40, 9) particella, util.substr_trim (riga_locazioni, 49, 4) subalterno,util.substr_trim (riga_locazioni, 53, 40) indirizzo FROM RE_LOCAZIONI_1_1 WHERE RE_flag_elaborato = 0 and util.substr_trim (riga_locazioni, 1, 1) = 'I'; UPDATE re_locazioni_1_1 SET RE_flag_elaborato = 1 where RE_flag_elaborato = 0; DELETE FROM locazioni_a a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0'));DELETE FROM locazioni_b a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_soggetto = b.prog_soggetto AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_immobile = b.prog_immobile AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_a a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_b a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.fornitura = b.fornitura AND a.prog_soggetto = b.prog_soggetto  AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.fornitura = b.fornitura AND a.prog_immobile = b.prog_immobile  AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0'));
rengine.jchain.in.4.key=TABELLE_SEMAFORO_2
rengine.jchain.in.4.value=RE_LOCAZIONI_1_1
#
rengine.jchain.in.5.key=COMANDISQL_3
rengine.jchain.in.5.value=INSERT INTO LOCAZIONI_A (UFFICIO, ANNO, SERIE, NUMERO, SOTTONUMERO, PROG_NEGOZIO, DATA_REGISTRAZIONE, DATA_STIPULA, CODICE_NEGOZIO, IMPORTO_CANONE, VALUTA, DATA_INIZIO, DATA_FINE, TIPO_RECORD, FORNITURA)  select util.SUBSTR_TRIM(RIGA_LOCAZIONI, 2, 3) UFFICIO,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 5, 4)) ANNO,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 9, 2) SERIE,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 11, 6)) NUMERO,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 17, 3)) SOTTONUMERO, util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 20, 3)) PROG_NEGOZIO, util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 23, 10),'yyyy-mm-dd') DATA_REGISTRAZIONE,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 33, 10),'yyyy-mm-dd') DATA_STIPULA,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 43, 4) CODICE_NEGOZIO, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 47, 15) IMPORTO_CANONE,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 62, 1) VALUTA, util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 63, 10),'yyyy-mm-dd') DATA_INIZIO,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 73, 10),'yyyy-mm-dd') DATA_FINE, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) TIPO_RECORD,  TO_NUMBER(TO_CHAR(RE_DATA_INIZIO_VAL, 'YYMMDDHH24MISS')) FORNITURA  from RE_ATT_LOCAZIONI_MANUALI_1_0 where RE_flag_elaborato = 0  and util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) = 'A';  INSERT INTO LOCAZIONI_B (UFFICIO, ANNO, SERIE, NUMERO, SOTTONUMERO, PROG_NEGOZIO, PROG_SOGGETTO, TIPO_SOGGETTO, CODICEFISCALE, DATA_SUBENTRO, DATA_CESSIONE, TIPO_RECORD, FORNITURA)  SELECT UTIL.substr_trim (riga_locazioni, 2, 3) UFFICIO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 5, 4)) ANNO,        UTIL.substr_trim (riga_locazioni, 9, 2) SERIE,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 11, 6)) NUMERO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 17, 3)) SOTTONUMERO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 20, 3)) PROG_NEGOZIO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 23, 3)) PROG_SOGGETTO,        UTIL.substr_trim (riga_locazioni, 26, 1) TIPO_SOGGETTO,        UTIL.substr_trim (riga_locazioni, 27, 16) CODICEFISCALE,        util.fchar_to_date(UTIL.substr_trim (riga_locazioni, 43, 10),'yyyy-mm-dd') DATA_SUBENTRO,        util.fchar_to_date( UTIL.substr_trim (riga_locazioni, 53, 10),'yyyy-mm-dd') DATA_CESSIONE,        UTIL.substr_trim (riga_locazioni, 1, 1) TIPO_RECORD,        TO_NUMBER (TO_CHAR (RE_data_inizio_val, 'YYMMDDHH24MISS')) FORNITURA   FROM RE_ATT_LOCAZIONI_MANUALI_1_0  WHERE RE_flag_elaborato = 0 AND UTIL.substr_trim (riga_locazioni, 1, 1) = 'B';   UPDATE RE_ATT_LOCAZIONI_MANUALI_1_0 SET RE_flag_elaborato = 1 where RE_flag_elaborato = 0; DELETE FROM locazioni_a a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_b a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_soggetto = b.prog_soggetto AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_immobile = b.prog_immobile AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_a a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_b a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_soggetto = b.prog_soggetto AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_immobile = b.prog_immobile AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0'));
rengine.jchain.in.6.key=TABELLE_SEMAFORO_3
rengine.jchain.in.6.value=RE_ATT_LOCAZIONI_MANUALI_1_0
#
rengine.jchain.in.7.key=COMANDISQL_4
rengine.jchain.in.7.value=INSERT INTO LOCAZIONI_A (UFFICIO, ANNO, SERIE, NUMERO, SOTTONUMERO, PROG_NEGOZIO, DATA_REGISTRAZIONE, DATA_STIPULA, CODICE_NEGOZIO, IMPORTO_CANONE, VALUTA, DATA_INIZIO, DATA_FINE, TIPO_RECORD, FORNITURA)  select util.SUBSTR_TRIM(RIGA_LOCAZIONI, 2, 3) UFFICIO,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 5, 4)) ANNO,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 9, 2) SERIE,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 11, 6)) NUMERO,  util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 17, 3)) SOTTONUMERO, util.TO_NUMBER_ALL(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 20, 3)) PROG_NEGOZIO, util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 23, 10),'yyyy-mm-dd') DATA_REGISTRAZIONE,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 33, 10),'yyyy-mm-dd') DATA_STIPULA,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 43, 4) CODICE_NEGOZIO, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 47, 15) IMPORTO_CANONE,  util.SUBSTR_TRIM(RIGA_LOCAZIONI, 62, 1) VALUTA, util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 63, 10),'yyyy-mm-dd') DATA_INIZIO,  util.FCHAR_TO_DATE(util.SUBSTR_TRIM(RIGA_LOCAZIONI, 73, 10),'yyyy-mm-dd') DATA_FINE, util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) TIPO_RECORD,  TO_NUMBER(TO_CHAR(RE_DATA_INIZIO_VAL, 'YYMMDDHH24MISS')) FORNITURA  from RE_CON_LOCAZIONI_MANUALI_1_0 where RE_flag_elaborato = 0  and util.SUBSTR_TRIM(RIGA_LOCAZIONI, 1, 1) = 'A';  INSERT INTO LOCAZIONI_B (UFFICIO, ANNO, SERIE, NUMERO, SOTTONUMERO, PROG_NEGOZIO, PROG_SOGGETTO, TIPO_SOGGETTO, CODICEFISCALE, DATA_SUBENTRO, DATA_CESSIONE, TIPO_RECORD, FORNITURA)  SELECT UTIL.substr_trim (riga_locazioni, 2, 3) UFFICIO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 5, 4)) ANNO,        UTIL.substr_trim (riga_locazioni, 9, 2) SERIE,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 11, 6)) NUMERO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 17, 3)) SOTTONUMERO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 20, 3)) PROG_NEGOZIO,        UTIL.to_number_all (UTIL.substr_trim (riga_locazioni, 23, 3)) PROG_SOGGETTO,        UTIL.substr_trim (riga_locazioni, 26, 1) TIPO_SOGGETTO,        UTIL.substr_trim (riga_locazioni, 27, 16) CODICEFISCALE,        util.fchar_to_date(UTIL.substr_trim (riga_locazioni, 43, 10),'yyyy-mm-dd') DATA_SUBENTRO,        util.fchar_to_date( UTIL.substr_trim (riga_locazioni, 53, 10),'yyyy-mm-dd') DATA_CESSIONE,        UTIL.substr_trim (riga_locazioni, 1, 1) TIPO_RECORD,        TO_NUMBER (TO_CHAR (RE_data_inizio_val, 'YYMMDDHH24MISS')) FORNITURA   FROM RE_CON_LOCAZIONI_MANUALI_1_0  WHERE RE_flag_elaborato = 0 AND UTIL.substr_trim (riga_locazioni, 1, 1) = 'B'; INSERT INTO locazioni_i (tipo_record, fornitura, ufficio, anno, serie, numero, sottonumero, prog_negozio, prog_immobile, accatastamento, tipo_catasto, flg_intero_porz, codice_cat, sez_urbana, foglio, particella, subalterno, indirizzo) SELECT util.substr_trim (riga_locazioni, 1, 1) tipo_record, TO_NUMBER (TO_CHAR (re_data_inizio_val, 'YYMMDDHH24MISS')) fornitura, util.substr_trim (riga_locazioni, 2, 3) ufficio, util.to_number_all (util.substr_trim (riga_locazioni, 5, 4)) anno, util.substr_trim (riga_locazioni, 9, 2) serie, util.to_number_all (util.substr_trim (riga_locazioni, 11, 6)) numero, util.to_number_all (util.substr_trim (riga_locazioni, 17, 3)) sottonumero, util.to_number_all (util.substr_trim (riga_locazioni, 20, 3)) prog_negozio, util.to_number_all (util.substr_trim (riga_locazioni, 23, 3)) prog_immobile, util.substr_trim (riga_locazioni, 26, 1) accatastamento, util.substr_trim (riga_locazioni, 27, 1) tipo_catasto, util.substr_trim (riga_locazioni, 28, 1) flg_intero_porz, util.substr_trim (riga_locazioni, 29, 4) codice_cat, util.substr_trim (riga_locazioni, 33, 3) sez_urbana, util.substr_trim (riga_locazioni, 36, 4) foglio, util.substr_trim (riga_locazioni, 40, 9) particella, util.substr_trim (riga_locazioni, 49, 4) subalterno, util.substr_trim (riga_locazioni, 53, 40) indirizzo FROM re_con_locazioni_manuali_1_0 WHERE re_flag_elaborato='0' and util.substr_trim (riga_locazioni, 1, 1) = 'I';  UPDATE RE_CON_LOCAZIONI_MANUALI_1_0 SET RE_flag_elaborato = 1 where RE_flag_elaborato = 0; DELETE FROM locazioni_a a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_b a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_soggetto = b.prog_soggetto AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.fornitura < ANY (SELECT b.fornitura FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_immobile = b.prog_immobile AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_a a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_a b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_b a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_b b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_soggetto = b.prog_soggetto AND a.fornitura = b.fornitura  AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0')); DELETE FROM locazioni_i a WHERE a.ROWID < ANY (SELECT b.ROWID FROM locazioni_i b WHERE a.ufficio = b.ufficio AND a.anno = b.anno AND a.serie = b.serie AND a.numero = b.numero AND a.prog_immobile = b.prog_immobile AND a.fornitura = b.fornitura AND nvl(a.sottonumero,'0') = nvl(b.sottonumero,'0') AND nvl(a.prog_negozio,'0') = nvl(b.prog_negozio,'0'));
rengine.jchain.in.8.key=TABELLE_SEMAFORO_4
rengine.jchain.in.8.value=RE_CON_LOCAZIONI_MANUALI_1_0