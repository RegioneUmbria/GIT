#--------------------------------------------------------------
# File di configurazione in cui sono indicato i valori dei soli
# parametri di contesto della catena jelly da passare alla 
# regola 
#------------------------------------------------------------
# Numero di parametri previsti in input
rengine.jchain.in.nof=2
#------------------------------------------------------------
# Le coppie chiavi/valore hanno come key lo stesso nome 
# indicato nello script jelly xml
#------------------------------------------------------------
rengine.jchain.in.1.key=QUERYSQL_1
rengine.jchain.in.1.value=SELECT TO_CHAR(PERSNIND) ID_ORIG, PERSNIND, PERSCOGN COGNOME, PERSNOME NOME, DECODE(PERSSESSO,1,'M',2,'F',NULL) SESSO, POSIANA.CPOADESC POSIZ_ANA, LPAD(TO_CHAR(PERS_CCOMPROVNA),3,'0') ID_ORIG_PROVINCIA_NASCITA, LPAD(TO_CHAR(PERS_CCOMPROVNA),3,'0') || LPAD(TO_CHAR(PERS_CCOMCODINA),3,'0') ID_ORIG_COMUNE_NASCITA, PERSNASCDATA DATA_NASCITA, TO_CHAR(PERS_PERSNINDPADR) ID_ORIG_D_PERSONA_PADRE, TO_CHAR(PERS_PERSNINDMADR) ID_ORIG_D_PERSONA_MADRE, DECODE(D_P.PERSSESSO,1,staciv.ccivdescma,staciv.ccivdescfe) STATO_CIVILE, TO_CHAR(PERS_CSTACODI) ID_ORIG_STATO, PERSCODIFISC CODFISC, PERSMORTDATA DATA_MOR, LPAD(TO_CHAR(PERS_CCOMPROVMO),3,'0') ID_ORIG_PROVINCIA_MOR, LPAD(TO_CHAR(PERS_CCOMPROVMO),3,'0') || LPAD(PERS_CCOMCODIMO,3,'0') ID_ORIG_COMUNE_MOR, DECODE(D_P.pers_cpoacodi,10, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0') || LPAD(i_c.isca_ccomcodii,3,'0') ,NULL) ID_ORIG_COMUNE_IMM, DECODE(D_P.pers_cpoacodi,10, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0'),NULL) ID_ORIG_PROVINCIA_IMM, DECODE(D_P.pers_cpoacodi,10, i_c.iscadatai,NULL) DATA_IMM, DECODE(D_P.pers_cpoacodi,40, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0') || LPAD(i_c.isca_ccomcodii,3,'0'), 30, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0') || LPAD(i_c.isca_ccomcodii,3,'0'),NULL) ID_ORIG_COMUNE_EMI, DECODE(D_P.pers_cpoacodi,40,LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0'),30, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0'),60, LPAD(TO_CHAR(i_c.isca_ccomprovi),3,'0'),NULL) ID_ORIG_PROVINCIA_EMI, DECODE(D_P.pers_cpoacodi,40,i_c.iscadatai, 30, i_c.iscadatai,60, i_c.iscadatai,NULL) DATA_EMI, D_P.CARONTE_DATA_INIZIO_VAL DT_EXP_DATO FROM DS_D_PERSONE_1_0 D_P, DS_D_CODI_POSIANA_1_0 posiana, DS_D_CODI_STATCIVILE_1_0 staciv, (SELECT isca_persnind, isca_ccomcodii, isca_ccomprovi, iscadatai FROM DS_D_ISCR_CANC_1_0 i_c1 WHERE iscadatai = ( SELECT MAX (iscadatai) FROM DS_D_ISCR_CANC_1_0 i_c2 WHERE i_c2.isca_persnind = i_c1.isca_persnind)) i_c WHERE d_p.pers_cpoacodi = posiana.cpoacodi(+) AND d_p.pers_ccivcodi = staciv.ccivcodi(+) AND d_p.persnind = i_c.isca_persnind(+) AND D_P.CARONTE_FLAG_ELABORATO = 0
rengine.jchain.in.2.key=RSITRSCRIPT_1
rengine.jchain.in.2.value=<RsIterator> <key table="DS_D_PERSONE_1_0"> <column name="ID_ORIG"/> <column name="DT_EXP_DATO"/> </key> <commands> <command name="it.webred.rulengine.brick.loadDwh.base.LoadSitDPersona" livelloAnomalie="2"> <param id="field" value="ID_ORIG" dest="ID_ORIG" type="java.lang.String"/> <param id="const" value="1" dest="FK_ENTE_SORGENTE" type="java.lang.Integer"/> <param id="field" value="COGNOME" dest="COGNOME" type="java.lang.String"/> <param id="field" value="NOME" dest="NOME" type="java.lang.String"/> <param id="field" value="SESSO" dest="SESSO" type="java.lang.String"/> <param id="field" value="CODFISC" dest="CODFISC" type="java.lang.String"/> <param id="field" value="POSIZ_ANA" dest="POSIZ_ANA" type="java.lang.String"/> <param id="field" value="STATO_CIVILE" dest="STATO_CIVILE" type="java.lang.String"/> <param id="const" value="" dest="DES_PERSONA" type="java.lang.String"/> <param id="const" value="" dest="DATA_INIZIO_RESIDENZA" type="java.sql.Timestamp"/> <param id="field" value="ID_ORIG_STATO" dest="ID_ORIG_STATO" type="java.lang.String"/> <param id="field" value="ID_ORIG_PROVINCIA_IMM" dest="ID_ORIG_PROVINCIA_IMM" type="java.lang.String"/> <param id="field" value="ID_ORIG_COMUNE_IMM" dest="ID_ORIG_COMUNE_IMM" type="java.lang.String"/> <param id="field" value="DATA_IMM" dest="DATA_IMM" type="java.sql.Timestamp"/> <param id="field" value="ID_ORIG_PROVINCIA_EMI" dest="ID_ORIG_PROVINCIA_EMI" type="java.lang.String"/> <param id="field" value="ID_ORIG_COMUNE_EMI" dest="ID_ORIG_COMUNE_EMI" type="java.lang.String"/> <param id="field" value="DATA_EMI" dest="DATA_EMI" type="java.sql.Timestamp"/> <param id="field" value="ID_ORIG_PROVINCIA_MOR" dest="ID_ORIG_PROVINCIA_MOR" type="java.lang.String"/> <param id="field" value="ID_ORIG_COMUNE_MOR" dest="ID_ORIG_COMUNE_MOR" type="java.lang.String"/> <param id="field" value="DATA_MOR" dest="DATA_MOR" type="java.sql.Timestamp"/> <param id="field" value="ID_ORIG_PROVINCIA_NASCITA" dest="ID_ORIG_PROVINCIA_NASCITA" type="java.lang.String"/> <param id="field" value="ID_ORIG_COMUNE_NASCITA" dest="ID_ORIG_COMUNE_NASCITA" type="java.lang.String"/> <param id="field" value="DATA_NASCITA" dest="DATA_NASCITA" type="java.sql.Timestamp"/> <param id="field" value="ID_ORIG_D_PERSONA_MADRE" dest="ID_ORIG_D_PERSONA_MADRE" type="java.lang.String"/> <param id="field" value="ID_ORIG_D_PERSONA_PADRE" dest="ID_ORIG_D_PERSONA_PADRE" type="java.lang.String"/> <param id="field" value="DT_EXP_DATO" dest="DT_EXP_DATO" type="java.sql.Timestamp"/> <param id="const" value="" dest="DT_INI_VAL_DATO" type="java.sql.Timestamp"/> <param id="const" value="" dest="DT_FINE_VAL_DATO" type="java.sql.Timestamp"/> <param id="const" value="0" dest="FLAG_DT_VAL_DATO" type="java.lang.Integer"/> </command> <command name="it.webred.rulengine.brick.core.EseguiSql"> <param id="const" dest="SQL" type="java.lang.String"> <![CDATA[ update DS_D_PERSONE_1_0 SET CARONTE_FLAG_ELABORATO = 1 WHERE PERSNIND=? AND CARONTE_DATA_INIZIO_VAL=? ]]> </param> <param id="const" dest="PARAMETRI" type="it.webred.rulengine.type.ComplexParam"> <![CDATA[ <complexParam> <param name="param1"> [[PERSNIND]] </param> <param name="param2"> [[DT_EXP_DATO]] </param> </complexParam> ]]> </param> </command> </commands> </RsIterator>